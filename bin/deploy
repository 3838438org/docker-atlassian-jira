#!/usr/bin/env bash

git config --global user.email "circleci@circleci"
git config --global user.name "Circle CI Automated Builder"

VERSION=$(sed -n "s/ENV JIRA_VERSION[[:space:]]*\([[:digit:]].*\)/\1/p" Dockerfile)

git diff --exit-code .

if [[ $? == 1 ]]; then

	echo "Committing changes"

	git add --all
	git commit --message "Updated to Atlassian JIRA Early Access Preview version ${VERSION}"

	echo "Pushing new version ${VERSION}"

	git push origin eap

else

	echo "There was no changes, skipping deployment..."

fi
