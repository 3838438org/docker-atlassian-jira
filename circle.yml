machine:
  ruby:
    version: 2.2.3
  pre:
    - sudo apt-get install jq
    - gem install bundler
  services:
    - docker

dependencies:
  pre:
    - docker pull postgres:9.3
    - docker pull mysql:5.6
    - docker pull java:8
    - gem install bundler

database:
  override:
    - bin/setup_databases

test:
  pre:
    - bin/prepare
  override:
    - bundle exec rspec --format documentation --require rspec_junit_formatter --format RspecJunitFormatter --out $CIRCLE_TEST_REPORTS/rspec/junit.xml

deployment:
  newest-version:
    branch: master
    commands:
      - bin/deploy
